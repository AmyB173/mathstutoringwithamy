# Set a Content Security Policy
# Note: This is a basic policy. You may need to add more sources (e.g., for fonts, styles).
Header always set Content-Security-Policy "default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://kit.fontawesome.com https://assets.flodesk.com; style-src 'self' https://cdn.jsdelivr.net; font-src 'self' https://kit.fontawesome.com; upgrade-insecure-requests"

# Ensure server correctly identifies XML files
AddType application/xml xml

RewriteEngine On

# 1. Force HTTPS and www
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} !^www\. [NC]
RewriteCond %{HTTP_HOST} ^(?:www\.)?(.+)$ [NC]
RewriteRule ^ https://www.%1%{REQUEST_URI} [L,R=301,NE]

# 2. Redirect from .php URL to the clean URL (for SEO and bookmarks)
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# 3. Internally rewrite the clean URL to the .php file on the server
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^(.*)$ $1.php [L]